(function(u){typeof define=="function"&&define.amd?define(u):u()})(function(){"use strict";var F=Object.defineProperty;var I=(u,p,m)=>p in u?F(u,p,{enumerable:!0,configurable:!0,writable:!0,value:m}):u[p]=m;var y=(u,p,m)=>(I(u,typeof p!="symbol"?p+"":p,m),m);const u=["overlayCheckout","salesFunnel","inlineCheckout","element:creditCardForm"],p=(l,e)=>{const n=document.createElement("iframe");return e&&(n.id=e),n.className="custom-element__iframe",n.style.width="100%",n.style.minWidth="320px",n.style.minHeight="300px",n.style.border="0 none",n.style.display="block",n.allow="clipboard-write; payment *",n.src=l,n},m="https://pay.hotmart.com";class w{constructor(e,n){y(this,"options",{payment:{},visibilityOptions:{}});y(this,"wrapperElement");y(this,"iframeElement");y(this,"iframeURL",new URL(m));this.options=e,console.debug("@@@@ this.options:",this.options);const i={...{elements_document_height_update:t=>{this.iframeElement&&(this.iframeElement.style.height=t)},on_load:()=>{var t,r,f,d,c,a,s,h;this.postMessage({action:"set_data",data:{shopperData:(t=this.options.payment)==null?void 0:t.shopperData,hasErrorCallback:!!((r=this.options.payment)!=null&&r.onError),countryIsoCode:((f=this.options)==null?void 0:f.countryIsoCode)??"",gateways:(a=(c=(d=this.options)==null?void 0:d.elementOptions)==null?void 0:c.creditCardForm)==null?void 0:a.gateways}}),(h=(s=this.options)==null?void 0:s.onLoad)==null||h.call(s)}},...n||{}};window.addEventListener("message",t=>{var f;const r=t.source!==((f=this.iframeElement)==null?void 0:f.contentWindow);t.origin!==m||r||(console.debug("@@@@ message:",t),!(!t.data.action||!Object.keys(i).includes(t.data.action))&&i[t.data.action](t.data.data))})}updateOptions(e){this.options={...this.options,...e}}postMessage({action:e,data:n}){var o,i;(i=(o=this.iframeElement)==null?void 0:o.contentWindow)==null||i.postMessage({action:e,data:n},"*")}mount(e){var o;if(this.options.integrationKey&&this.iframeURL.searchParams.append("integrationKey",this.options.integrationKey),this.options.locale&&this.iframeURL.searchParams.append("locale",this.options.locale),this.options.countryIsoCode&&this.iframeURL.searchParams.append("countrycode",this.options.countryIsoCode),this.options.prefilledInfo)for(const[i,t]of Object.entries(this.options.prefilledInfo))this.iframeURL.searchParams.append(i,t);if(this.options.visibilityOptions)for(const[i,t]of Object.entries(this.options.visibilityOptions))this.iframeURL.searchParams.append(i,t);const n=p(this.iframeURL.href);this.iframeElement=n,this.wrapperElement=typeof e=="string"?document.querySelector(e):e,this.wrapperElement&&(this.wrapperElement.innerHTML="",(o=this.wrapperElement)==null||o.appendChild(n),console.debug("@@@@ element mounted successfully"))}}class g extends w{constructor(e,n){const o={on_payment_approve:i=>{var t,r;(r=(t=this.options.payment)==null?void 0:t.onSuccess)==null||r.call(t,i)},on_payment_error:i=>{var t,r;(r=(t=this.options.payment)==null?void 0:t.onError)==null||r.call(t,i)},on_submit_payment:({actionToCall:i})=>{var t,r;this.postMessage({action:"process_payment",data:{shopperData:(t=this.options.payment)==null?void 0:t.shopperData,hasErrorCallback:!!((r=this.options.payment)!=null&&r.onError),actionToCall:i}})},...n||{}};super(e,o),this.iframeURL=new URL(`${m}/elements?off=${this.options.offer}&checkoutMode=2`),this.options.bid=new Date().getTime()}}class C extends g{constructor(e){super(e),console.debug("@@@@ Initializing OverlayCheckout element"),Promise.resolve().then(()=>x).then(n=>{const o=document.createElement("style");o.innerText=n.default,document.head.append(o)})}onKeyUp(e){e.key==="Escape"&&this.destroy()}attach(e){const n=typeof e=="string"?document.querySelector(e):e;e&&(n==null||n.addEventListener("click",o=>{o.preventDefault();const i=document.createElement("div");i.id="custom-element-lightbox-overlay",i.className="custom-element__lightbox-overlay",i.addEventListener("click",()=>{this.destroy()});const t=document.createElement("div");t.id="custom-element-lightbox-modal",t.className="custom-element__lightbox-modal",super.mount(t),document.body.appendChild(i),document.body.appendChild(t)}),document.addEventListener("keyup",o=>this.onKeyUp(o)),console.debug("@@@@ OverlayCheckout attached successfully"))}mount(e){this.attach(e)}destroy(){var e,n;(e=document.getElementById("custom-element-lightbox-overlay"))==null||e.remove(),(n=document.getElementById("custom-element-lightbox-modal"))==null||n.remove()}}class b extends g{constructor(e){super(e),this.iframeURL=new URL(`${m}/funnel${this.getMainPageSearchParams()}`),console.debug("@@@@ Initializing SalesFunnel element")}getMainPageSearchParams(){var e,n;try{return((n=(e=window.top)==null?void 0:e.location)==null?void 0:n.search)||window.location.search||""}catch{return window.location.search||""}}}class k extends g{constructor(e){super(e),this.iframeURL=new URL(`${m}/elements?off=${this.options.offer}&checkoutMode=2`),console.debug("@@@@ Initializing InlineCheckout element")}}class O extends w{constructor(e){var t,r,f;const n={on_generate_tokens_intent_success:d=>{var c,a,s,h;(h=(s=(a=(c=this.options)==null?void 0:c.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onGenerateTokensSuccess)==null||h.call(s,d)},on_generate_tokens_intent_error:d=>{var c,a,s,h;(h=(s=(a=(c=this.options)==null?void 0:c.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onGenerateTokensError)==null||h.call(s,d)},on_credit_card_form_valid:()=>{var d,c,a,s;(s=(a=(c=(d=this.options)==null?void 0:d.elementOptions)==null?void 0:c.creditCardForm)==null?void 0:a.onValidationSuccess)==null||s.call(a)},on_credit_card_form_invalid:d=>{var c,a,s,h;(h=(s=(a=(c=this.options)==null?void 0:c.elementOptions)==null?void 0:a.creditCardForm)==null?void 0:s.onValidationError)==null||h.call(s,d)}},o=(r=(t=e.elementOptions)==null?void 0:t.creditCardForm)==null?void 0:r.gateways,i=o&&Array.isArray(o)&&o.length?o:["ADYEN","WORLDPAY","DLOCAL","PAYU","EBANX"];e.elementOptions={...e.elementOptions,creditCardForm:{...(f=e.elementOptions)==null?void 0:f.creditCardForm,gateways:i}},super(e,n),this.iframeURL=new URL(`${m}/elements/credit-card-form`),console.debug("@@@@ Initializing creditCardForm element")}generateTokens(){this.postMessage({action:"generate_tokens_intent",data:{}}),console.debug("@@@@ tryToGenerateTokens Button triggered")}validateForm(){this.postMessage({action:"validate_intent",data:{}}),console.debug("@@@@ tryToValidateForm Button triggered")}}const E=(l,e={})=>{if(e.off&&(e.offer=e.off),!(e.offer||e.affiliation)&&["overlayCheckout","inlineCheckout"].includes(l))throw new Error("Offer must be present");const o={overlayCheckout:()=>new C(e),inlineCheckout:()=>new k(e),salesFunnel:()=>new b(e),"element:creditCardForm":()=>new O(e)};if(console.debug("@@@@ Initializing Checkout Elements"),!u.includes(l))throw new Error("Element type not available, please check the documentation");return o[l]()},L=10;let _=0;function v(){window.setTimeout(()=>{if(_>=L)return;_+=1;const l=Array.from(document.querySelectorAll("#hotmart-sales-funnel"));if(!l.length){v();return}l.some(e=>e.hasChildNodes())||E("salesFunnel").mount(l[0])},250)}v(),window.checkoutElements={init:E};const x=Object.freeze(Object.defineProperty({__proto__:null,default:".custom-element__iframe{border:none}.custom-element__lightbox-overlay{background-color:#000;position:fixed;width:100%;height:100%;top:0;left:0;opacity:.8}.custom-element__lightbox-modal{position:fixed;width:90%;max-width:90vw;min-height:500px;max-height:90vh;top:5%;left:50%;transform:translate(-50%);overflow:scroll}"},Symbol.toStringTag,{value:"Module"}))});
